<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>BloomReach Bynder Extension Dialog</title>

    <style>
      #bynder {
        height: 800px;
        width: 100%;
      }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@graphcms/zoid@9.0.64-alpha.1/lib/zoid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@graphcms/uix-sdk@0.1.2/dist/gcuix.umd.production.min.js"></script>
  <script src="https://d8ejoa1fys2rk.cloudfront.net/5.0.5/modules/compactview/bynder-compactview-2-latest.js"></script>    
</head>
  <body>
    <div id="bynder"></div>

    <script>
      (() => {
        const declaration = {
          extensionType: "field",
          fieldType: "JSON",
          name: "Bynder",
          description: "",
          features: ["FieldRenderer"],
        };

        document.addEventListener('DOMContentLoaded', async () => {
          try {
            window.GCUIX.init({
              declaration,
            }).then((initialState) => {
              const { status, props } = initialState;
              if (status === "ok") {
                const {
                  defaultDomain,
                  selectedAssetId,
                  onCloseDialog,
                } = props;

                const integration = {
                  type: 'graphcms_connector',
                  platform: 'GraphCMS',
                  //environment: ui.baseUrl || ''
                }

                BynderCompactView.open({
                  container: document.getElementById('bynder'),
                  portal: {url: props.defaultDomain || '', editable: props.defaultDomain ? false : true},
                  language: props.language || "en_US",
                  mode: props.mode || "SingleSelect",
                  assetTypes: props.assetTypes || ['image'],
                  selectedAssets: selectedAssetId,
                  onSuccess: function(assets, additionalInfo) {
                    onCloseDialog(assets.length ? JSON.stringify(assets) : '[]');
                  }
                });        
              }
            });
          } catch(error) {
            console.error('Failed to init extension:', error.message);
            console.error('- error code:', error.code);
          }
        });          
      })();
    </script>
  </body>
</html>